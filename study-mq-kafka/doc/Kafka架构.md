# 1. 介绍

​		它是一个分布式的，支持多分区、多副本，基于 Zookeeper 的分布式消息流平台，它同时也是一款开源的基于发布订阅模式的消息引擎系统。

## 1.1 Kafka特性

1. 高吞吐、低延迟

   kakfa 最大的特点就是收发消息非常快，kafka 每秒可以处理几十万条消息，它的最低延迟只有几毫秒

2. 高伸缩性

   每个主题(topic) 包含多个分区(partition)，主题中的分区可以分布在不同的主机(broker)中

3. 持久性、可靠性

   Kafka 能够允许数据的持久化存储，消息被持久化到磁盘，并支持数据备份防止数据丢失，Kafka 底层的数据存储是基于 Zookeeper 存储的，Zookeeper 我们知道它的数据能够持久存储

4. 容错性

   允许集群中的节点失败，某个节点宕机，Kafka 集群能够正常工作；

5. 高并发

   支持数千个客户端同时读写

## 1.2 Kafka使用场景



# 2. 基本术语

1. 消息

   Kafka 中的数据单元被称为消息，也被称为记录，可以把它看作数据库表中某一行的记录

2. 主题

   消息的种类称为 主题（Topic）,可以说一个主题代表了一类消息。相当于是对消息进行分类。主题就像是数据库中的表

3. 分区

4. 生产者

5. 消费者

6. 代理

7. 消费者群组

8. 偏移量



# 3. 主题和分区

​		主题和分区是Kafka的两个核心概念。主题作为消息的归类，可以再分为一个或多个分区，分区也可以看做是对消息的二次归类。分区的划分不仅为Kafka提供了可伸缩性、水平扩展的功能，还通过副本机制来为Kafka提供数据冗余以提高数据可靠性。

​		从Kafka底层看，主题和分区是逻辑上的概念，分区可以有一至多个副本，每个副本对应一个日志文件，每个日志文件对应一至多个日志分段，每个日志分段还可以细分为索引文件、日志存储文件和快照文件

- 1分区：N副本
- 1副本：1日志文件
- 1日志文件：N日志分段
- 

# 4 生产者

## 3.1 发送方式

1. ###  简单消息发送

2. ### 同步消息发送

3. ### 异步消息发送

## 3.1 分区机制

​		Kafka 对于数据的读写是以分区为粒度的，分区可以分布在多个主机（Broker）中。这样每个节点能够实现独立的数据写入和读取，并且能够通过增加新的节点来增加 Kafka 集群的吞吐量，通过分区部署在多个 Broker 来实现负载均衡的效果。

### 3.1.1分区策略

​		Kafka 的分区策略指的就是将生产者发送到哪个分区的算法。Kafka 为我们提供了默认的分区策略，同时它也支持你自定义分区策略。

1. 顺序轮询

   顺序分配，消息是均匀的分配给每个 partition，即每个分区存储一次消息。轮训策略是 Kafka Producer 提供的默认策略，如果你不使用指定的轮训策略的话，Kafka 默认会使用顺序轮训策略的方式。

2. 随机轮询

   随机轮询简而言之就是随机的向 partition 中保存消息。本质上看随机策略也是力求将数据均匀地打散到各个分区，但从实际表现来看，它要逊于轮询策略，所以如果追求数据的均匀分布，还是使用轮询策略比较好

3. 按照 key 进行消息保存

## 3.1 压缩机制

# 4 消费者

## 4.1 消费方式

1. 队列
2. 订阅

# 5 Kafka 为何如此之快

Kafka 实现了零拷贝原理来快速移动数据，避免了内核之间的切换。Kafka 可以将数据记录分批发送，从生产者到文件系统（Kafka 主题日志）到消费者，可以端到端的查看这些批次的数据。批处理能够进行更有效的数据压缩并减少 I/O 延迟，Kafka 采取顺序写入磁盘的方式，避免了随机磁盘寻址的浪费，更多关于磁盘寻址的了解，请参阅 程序员需要了解的硬核知识之磁盘 。

总结一下其实就是四个要点

- 顺序读写
- 零拷贝
- 消息压缩
- 分批发送



